<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags, Title, and CSS Link -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Page Title</title>
    <!-- HTMX Script -->
    <script src="https://unpkg.com/htmx.org@1.4.0/dist/htmx.min.js"></script>
</head>
<body>
    <!-- Search Form -->
    <div id="search-container">
        <!-- Adding hx-select to ensure the form itself is targeted for values -->
        <form id="filter-form" hx-get="http://localhost:8000/players/filter/" hx-trigger="keyup changed delay:500ms, change" hx-select="#filter-form" hx-target="#search-results" hx-indicator="#loading">
            <!-- Username Input -->
            <input type="text" name="username" placeholder="Username">

            <!-- Trophies Input -->
            <input type="number" name="trophies" placeholder="Trophies">

            <!-- Favourite Brawler Input -->
            <input type="text" name="favorite_brawler" placeholder="Favorite Brawler">

            <!-- Is Looking For Clan Checkbox -->
            <label>
                <input type="checkbox" name="is_looking_for_clan"> Is Looking For Clan
            </label>

            <!-- Win Rate Input -->
            <input type="number" name="win_rate" placeholder="Win Rate" step="0.01">

            <!-- Games Won Input -->
            <input type="number" name="games_won" placeholder="Games Won">

            <!-- Submit Button - optional if you want explicit submission -->
            <button type="submit">Filter</button>
        </form>

        <!-- Loading Indicator -->
        <div id="loading" style="display:none;">Loading...</div>

        <!-- Search Results -->
        <div id="search-results">
            <!-- Filtered Players will be displayed here -->
        </div>
    </div>
    <!-- HTMX Script -->
    <script src="https://unpkg.com/htmx.org"></script>
</body>
<script>
    function applyFilters(event) {
        event.preventDefault(); // Prevent the default form submission

        // Collect all filter values
        var username = document.getElementById('username').value;
        var trophies = document.getElementById('trophies').value;
        var favorite_brawler = document.getElementById('favorite_brawler').value;
        var is_looking_for_clan = document.getElementById('is_looking_for_clan').checked;
        var win_rate = document.getElementById('win_rate').value;
        var games_won = document.getElementById('games_won').value;

        // Build the query string
        var queryParams = new URLSearchParams({
            username: username,
            trophies: trophies,
            favorite_brawler: favorite_brawler,
            is_looking_for_clan: is_looking_for_clan,
            win_rate: win_rate,
            games_won: games_won
        });

        // Create the request URL with all query parameters
        var requestUrl = `http://localhost:8000/players/filter/?${queryParams}`;

        // Make the request and update the page
        fetch(requestUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.text(); // Expecting an HTML response
            })
            .then(html => {
                // Update the search-results div with the response
                document.getElementById('search-results').innerHTML = html;
            })
            .catch(error => {
                console.error('Error fetching filtered players:', error);
                document.getElementById('search-results').innerHTML = 'Error loading results.';
            });
    }
</script>


</html>
